<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>solarnetwork-api-core</title><meta name="description" content="Documentation for solarnetwork-api-core"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">solarnetwork-api-core</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>solarnetwork-api-core</h1></div><div class="tsd-panel tsd-typography"><h1 id="solarnetwork-core-api---javascript" class="tsd-anchor-link">SolarNetwork Core API - JavaScript<a href="#solarnetwork-core-api---javascript" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This project contains JavaScript code to help access the <a href="https://github.com/SolarNetwork/solarnetwork/wiki/API-Developer-Guide">SolarNetwork API</a>.
To include the library in your NPM-based project, run the following:</p>
<pre><code class="sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">i</span><span class="hl-1"> </span><span class="hl-2">solarnetwork-api-core</span>
</code><button type="button">Copy</button></pre>

<h1 id="api-docs" class="tsd-anchor-link">API docs<a href="#api-docs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The latest API documentation is published <a href="https://solarnetwork.github.io/sn-api-core-js/">here</a>, or
you can build the API documentation by running the <code>apidoc</code> script:</p>
<pre><code class="sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">apidoc</span>
</code><button type="button">Copy</button></pre>

<p>That will produce HTML documentation in <code>docs/html</code>.</p>
<h1 id="example-query-datum" class="tsd-anchor-link">Example: Query datum<a href="#example-query-datum" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Here's an example use of the library, targeted for use in a browser using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a> to
access the <a href="https://github.com/SolarNetwork/solarnetwork/wiki/SolarQuery-Stream-API#datum-stream-reading-list">/datum/stream/reading</a> SolarNetwork API:</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-4">Aggregations</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">Datum</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">DatumFilter</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">DatumReadingTypes</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">DatumStreamMetadataInfo</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">Result</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;solarnetwork-api-core/domain&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-4">AuthorizationV2Builder</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">HttpContentType</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">HttpHeaders</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">HttpMethod</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">SolarQueryApi</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;solarnetwork-api-core/net&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-4">DatumStreamMetadataRegistry</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">Datum</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-4">DatumUtil</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;solarnetwork-api-core/util&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">/**</span><br/><span class="hl-5"> * Fetch hourly reading data for a datum stream using the stream API.</span><br/><span class="hl-5"> *</span><br/><span class="hl-5"> * </span><span class="hl-6">@param</span><span class="hl-5"> </span><span class="hl-4">nodeId</span><span class="hl-5"> - the node ID to fetch data for</span><br/><span class="hl-5"> * </span><span class="hl-6">@param</span><span class="hl-5"> </span><span class="hl-4">sourceId</span><span class="hl-5">  - the source ID to fetch data for</span><br/><span class="hl-5"> * </span><span class="hl-6">@param</span><span class="hl-5"> </span><span class="hl-4">startDate</span><span class="hl-5"> - the minimum date</span><br/><span class="hl-5"> * </span><span class="hl-6">@param</span><span class="hl-5"> </span><span class="hl-4">endDate</span><span class="hl-5"> - the maximum date</span><br/><span class="hl-5"> * </span><span class="hl-6">@param</span><span class="hl-5"> </span><span class="hl-4">token</span><span class="hl-5"> - the security token to authenticate with</span><br/><span class="hl-5"> * </span><span class="hl-6">@param</span><span class="hl-5"> </span><span class="hl-4">tokenSecret</span><span class="hl-5"> - the security token secret</span><br/><span class="hl-5"> * </span><span class="hl-6">@returns</span><span class="hl-5"> the data, as an array of general datum</span><br/><span class="hl-5"> */</span><br/><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">fetchReadingDatumStream</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-4">nodeId</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">sourceId</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">startDate</span><span class="hl-1">: </span><span class="hl-7">Date</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">endDate</span><span class="hl-1">: </span><span class="hl-7">Date</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">token</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">tokenSecret</span><span class="hl-1">: </span><span class="hl-7">string</span><br/><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">Datum</span><span class="hl-1">[]&gt; {</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">filter</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumFilter</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">aggregation</span><span class="hl-1"> = </span><span class="hl-4">Aggregations</span><span class="hl-1">.</span><span class="hl-4">Hour</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">nodeId</span><span class="hl-1"> = </span><span class="hl-4">nodeId</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">sourceId</span><span class="hl-1"> = </span><span class="hl-4">sourceId</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">startDate</span><span class="hl-1"> = </span><span class="hl-4">startDate</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">endDate</span><span class="hl-1"> = </span><span class="hl-4">endDate</span><span class="hl-1">;</span><br/><br/><span class="hl-1">	</span><span class="hl-5">// encode the URL request for the /datum/stream/reading API</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">urlHelper</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SolarQueryApi</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">streamDataUrl</span><span class="hl-1"> = </span><span class="hl-4">urlHelper</span><span class="hl-1">.</span><span class="hl-0">streamReadingUrl</span><span class="hl-1">(</span><br/><span class="hl-1">		</span><span class="hl-4">DatumReadingTypes</span><span class="hl-1">.</span><span class="hl-4">Difference</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-4">filter</span><br/><span class="hl-1">	);</span><br/><br/><span class="hl-1">	</span><span class="hl-5">// create URL and auth headers for API request</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">auth</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">AuthorizationV2Builder</span><span class="hl-1">(</span><span class="hl-4">token</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">authHeader</span><span class="hl-1"> = </span><span class="hl-4">auth</span><span class="hl-1">.</span><span class="hl-0">snDate</span><span class="hl-1">(</span><span class="hl-6">true</span><span class="hl-1">).</span><span class="hl-0">url</span><span class="hl-1">(</span><span class="hl-4">streamDataUrl</span><span class="hl-1">).</span><span class="hl-0">build</span><span class="hl-1">(</span><span class="hl-4">tokenSecret</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">headers</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Headers</span><span class="hl-1">({</span><br/><span class="hl-1">		</span><span class="hl-4">Authorization:</span><span class="hl-1"> </span><span class="hl-4">authHeader</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-4">Accept:</span><span class="hl-1"> </span><span class="hl-4">HttpContentType</span><span class="hl-1">.</span><span class="hl-8">APPLICATION_JSON</span><span class="hl-1">,</span><br/><span class="hl-1">	});</span><br/><span class="hl-1">	</span><span class="hl-4">headers</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-4">HttpHeaders</span><span class="hl-1">.</span><span class="hl-8">X_SN_DATE</span><span class="hl-1">, </span><span class="hl-4">auth</span><span class="hl-1">.</span><span class="hl-4">requestDateHeaderValue</span><span class="hl-1">!);</span><br/><br/><span class="hl-1">	</span><span class="hl-5">// make API request and get response as JSON</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">res</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-4">streamDataUrl</span><span class="hl-1">, {</span><br/><span class="hl-1">		</span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-4">HttpMethod</span><span class="hl-1">.</span><span class="hl-8">GET</span><span class="hl-1">,</span><br/><span class="hl-1">		</span><span class="hl-4">headers:</span><span class="hl-1"> </span><span class="hl-4">headers</span><span class="hl-1">,</span><br/><span class="hl-1">	});</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">json</span><span class="hl-1"> = (</span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">()) </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-7">Result</span><span class="hl-1">&lt;</span><span class="hl-7">any</span><span class="hl-1">&gt;;</span><br/><br/><span class="hl-1">	</span><span class="hl-5">// convert stream result into Datum objects</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1">: </span><span class="hl-7">Datum</span><span class="hl-1">[] = [];</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">meta</span><span class="hl-1">: </span><span class="hl-7">DatumStreamMetadataInfo</span><span class="hl-1">[] = </span><span class="hl-4">json</span><span class="hl-1">.</span><span class="hl-4">meta</span><span class="hl-1">!;</span><br/><span class="hl-1">	</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">reg</span><span class="hl-1"> = </span><span class="hl-4">DatumStreamMetadataRegistry</span><span class="hl-1">.</span><span class="hl-0">fromJsonObject</span><span class="hl-1">(</span><span class="hl-4">meta</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">reg</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">Promise</span><span class="hl-1">.</span><span class="hl-0">reject</span><span class="hl-1">(</span><span class="hl-2">&quot;JSON could not be parsed.&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">	</span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">data</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">json</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">meta</span><span class="hl-1"> = </span><span class="hl-4">reg</span><span class="hl-1">.</span><span class="hl-0">metadataAt</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">]);</span><br/><span class="hl-1">		</span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">meta</span><span class="hl-1">) {</span><br/><span class="hl-1">			</span><span class="hl-3">continue</span><span class="hl-1">;</span><br/><span class="hl-1">		}</span><br/><span class="hl-1">		</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">d</span><span class="hl-1"> = </span><span class="hl-4">DatumUtil</span><span class="hl-1">.</span><span class="hl-0">datumForStreamData</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">meta</span><span class="hl-1">)?.</span><span class="hl-0">toObject</span><span class="hl-1">();</span><br/><span class="hl-1">		</span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">d</span><span class="hl-1">) {</span><br/><span class="hl-1">			</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Datum</span><span class="hl-1">(</span><span class="hl-4">d</span><span class="hl-1">.</span><span class="hl-0">toObject</span><span class="hl-1">()));</span><br/><span class="hl-1">		}</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">	</span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-7">Promise</span><span class="hl-1">.</span><span class="hl-0">resolve</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h1 id="example-datumloader" class="tsd-anchor-link">Example: DatumLoader<a href="#example-datumloader" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The <code>DatumLoader</code> class helps return data from the SolarQuery <a href="https://github.com/SolarNetwork/solarnetwork/wiki/SolarQuery-API#datum-list">/datum/list</a>
endpoint. The class takes care of loading all results for a given search criteria, including making
multiple API requests to download all result pages when more than one page of results are available.</p>
<p>Here's an example of loading a month's worth of data for SolarNode 123:</p>
<pre><code class="js"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">filter</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumFilter</span><span class="hl-1">();</span><br/><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">nodeId</span><span class="hl-1"> = </span><span class="hl-9">123</span><span class="hl-1">;</span><br/><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">startDate</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;Sat, 1 Apr 2017 12:00:00 GMT&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">endDate</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-2">&quot;Mon, 1 May 2017 12:00:00 GMT&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">api</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SolarQueryApi</span><span class="hl-1">();</span><br/><br/><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumLoader</span><span class="hl-1">(</span><span class="hl-4">api</span><span class="hl-1">, </span><span class="hl-4">filter</span><span class="hl-1">).</span><span class="hl-0">load</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">results</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-5">// results is an array of Datum objects</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>A Promise based API is available as well:</p>
<pre><code class="js"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumLoader</span><span class="hl-1">(</span><span class="hl-4">api</span><span class="hl-1">, </span><span class="hl-4">filter</span><span class="hl-1">).</span><span class="hl-0">fetch</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h1 id="example-multiloader" class="tsd-anchor-link">Example: MultiLoader<a href="#example-multiloader" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The <code>MultiLoader</code> class helps load data from multiple <code>Loader</code> objects (the
<code>DatumLoader</code> class conforms to that interface). This is useful for pulling
down data from different search criterias all in one go. For example:</p>
<pre><code class="js"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">filter1</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumFilter</span><span class="hl-1">();</span><br/><span class="hl-4">filter1</span><span class="hl-1">.</span><span class="hl-4">nodeId</span><span class="hl-1"> = </span><span class="hl-9">123</span><span class="hl-1">;</span><br/><span class="hl-4">filter1</span><span class="hl-1">.</span><span class="hl-4">sourceId</span><span class="hl-1"> = </span><span class="hl-2">&quot;a&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">filter2</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumFilter</span><span class="hl-1">();</span><br/><span class="hl-4">filter2</span><span class="hl-1">.</span><span class="hl-4">nodeId</span><span class="hl-1"> = </span><span class="hl-9">234</span><span class="hl-1">;</span><br/><span class="hl-4">filter2</span><span class="hl-1">.</span><span class="hl-4">sourceIds</span><span class="hl-1"> = [</span><span class="hl-2">&quot;b&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;c&quot;</span><span class="hl-1">];</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">api</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SolarQueryApi</span><span class="hl-1">();</span><br/><br/><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">MultiLoader</span><span class="hl-1">([</span><br/><span class="hl-1">	</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumLoader</span><span class="hl-1">(</span><span class="hl-4">api</span><span class="hl-1">, </span><span class="hl-4">filter1</span><span class="hl-1">),</span><br/><span class="hl-1">	</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumLoader</span><span class="hl-1">(</span><span class="hl-4">api</span><span class="hl-1">, </span><span class="hl-4">filter2</span><span class="hl-1">),</span><br/><span class="hl-1">]).</span><span class="hl-0">load</span><span class="hl-1">((</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">results</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-5">// results is a 2-element array of Datum arrays</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-1"># </span><span class="hl-4">or</span><span class="hl-1"> </span><span class="hl-4">via</span><span class="hl-1"> </span><span class="hl-4">promise</span><span class="hl-1">...</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">MultiLoader</span><span class="hl-1">([</span><br/><span class="hl-1">	</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumLoader</span><span class="hl-1">(</span><span class="hl-4">api</span><span class="hl-1">, </span><span class="hl-4">filter1</span><span class="hl-1">),</span><br/><span class="hl-1">	</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumLoader</span><span class="hl-1">(</span><span class="hl-4">api</span><span class="hl-1">, </span><span class="hl-4">filter2</span><span class="hl-1">),</span><br/><span class="hl-1">]).</span><span class="hl-0">fetch</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h1 id="example-datumrangefinder" class="tsd-anchor-link">Example: DatumRangeFinder<a href="#example-datumrangefinder" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The <code>DatumRangeFinder</code> class helps find the date range of available data for a set of SolarNodes.
This is useful when generating reports or charts for a set of SolarNode datum streams, so the
overall start/end dates can be determined before requesting the actual data. For example:</p>
<pre><code class="js"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">api</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SolarQueryApi</span><span class="hl-1">();</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">filter</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumFilter</span><span class="hl-1">();</span><br/><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">nodeId</span><span class="hl-1"> = </span><span class="hl-9">123</span><span class="hl-1">;</span><br/><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">sourceIds</span><span class="hl-1"> = [</span><span class="hl-2">&quot;a&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;b&quot;</span><span class="hl-1">];</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">range</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumRangeFinder</span><span class="hl-1">(</span><span class="hl-4">api</span><span class="hl-1">, </span><span class="hl-4">filter</span><span class="hl-1">).</span><span class="hl-0">fetch</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>Ranges for more complex queries can be accomplished by passing in an array of filters, like this
example, continuing from the last one:</p>
<pre><code class="js"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">filter2</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumFilter</span><span class="hl-1">();</span><br/><span class="hl-4">filter2</span><span class="hl-1">.</span><span class="hl-4">nodeId</span><span class="hl-1"> = </span><span class="hl-9">234</span><span class="hl-1">;</span><br/><span class="hl-4">filter2</span><span class="hl-1">.</span><span class="hl-4">sourceId</span><span class="hl-1"> = </span><span class="hl-2">&quot;c&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">range2</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumRangeFinder</span><span class="hl-1">(</span><span class="hl-4">api</span><span class="hl-1">, [</span><span class="hl-4">filter1</span><span class="hl-1">, </span><span class="hl-4">filter2</span><span class="hl-1">]).</span><span class="hl-0">fetch</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h1 id="example-datumsourcefinder" class="tsd-anchor-link">Example: DatumSourceFinder<a href="#example-datumsourcefinder" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The <code>DatumSourceFinder</code> class helps find the available source IDs for a set of node IDs.</p>
<pre><code class="js"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">api</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SolarQueryApi</span><span class="hl-1">();</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">filter</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumFilter</span><span class="hl-1">();</span><br/><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">nodeId</span><span class="hl-1"> = </span><span class="hl-9">123</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">sources</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumSourceFinder</span><span class="hl-1">(</span><span class="hl-4">api</span><span class="hl-1">, </span><span class="hl-4">filter</span><span class="hl-1">).</span><span class="hl-0">fetch</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>Wildcard patterns can also be used to limit the search to a more specific set of source IDs,
and start/end dates can also be used to narrow the search, for example:</p>
<pre><code class="js"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">api</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SolarQueryApi</span><span class="hl-1">();</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">filter</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumFilter</span><span class="hl-1">();</span><br/><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">startDate</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() - </span><span class="hl-9">24</span><span class="hl-1"> * </span><span class="hl-9">60</span><span class="hl-1"> * </span><span class="hl-9">60</span><span class="hl-1"> * </span><span class="hl-9">1000</span><span class="hl-1">);</span><br/><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">sourceId</span><span class="hl-1"> = </span><span class="hl-2">&quot;/power/**&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">sources2</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">DatumSourceFinder</span><span class="hl-1">(</span><span class="hl-4">api</span><span class="hl-1">, </span><span class="hl-4">filter</span><span class="hl-1">).</span><span class="hl-0">fetch</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<h1 id="example-control-toggler" class="tsd-anchor-link">Example: Control Toggler<a href="#example-control-toggler" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Control Toggler is a helper class that uses the SolarNetwork <a href="https://github.com/SolarNetwork/solarnetwork/wiki/SolarUser-API#queue-instruction">Instruction API</a> to
request a SolarNode to set the value of a <em>control</em> to <code>1</code> (on) or <code>0</code> (off), and the
SolarNetwork <a href="https://github.com/SolarNetwork/solarnetwork/wiki/SolarQuery-API#most-recent-datum">Datum Query API</a> to track the value of the control.</p>
<p>The Instruction API is asynchronous and changing a control value requires the following steps:</p>
<ul>
<li>Enqueue instruction to set control value</li>
<li>Wait for SolarNode to receive, execute, and update instruction status to <code>Completed</code> (or <code>Rejected</code>)</li>
<li>Wait for SolarNode to post updated control value datum for confirmation</li>
</ul>
<p>Control Toggler handles these steps through a simple API for setting the desired value and using
a callback function to get notified when the value changes.</p>
<p>Some example SolarNode plugins that support on/off switching are:</p>
<ul>
<li><a href="https://github.com/SolarNetwork/solarnetwork-node/tree/master/net.solarnetwork.node.control.mock">Mock Control</a> (good for testing)</li>
<li><a href="https://github.com/SolarNetwork/solarnetwork-node/tree/master/net.solarnetwork.node.control.jf2.lata">LATA switch</a></li>
<li><a href="https://github.com/SolarNetwork/solarnetwork-node/tree/master/net.solarnetwork.node.control.modbus.toggle">Modbus switch</a></li>
</ul>
<h1 id="upgrading-from-1x" class="tsd-anchor-link">Upgrading from 1.x<a href="#upgrading-from-1x" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The 2.x version of this library has changed somewhat as the 1.x library was ported
to TypeScript and updated to ES2022. Most of the same classes and methods have
been preserved, but some things have moved namespaces. Thankfully the move to
TypeScript makes refactoring an application using the 1.x API pretty straightforward,
as your IDE can usually offer the correct <code>import</code> path to use for a given class.</p>
<p>For example, in the 1.x API you might have:</p>
<pre><code class="js"><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-4">Aggregations</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">AuthorizationV2Builder</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">DatumFilter</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">DatumReadingTypes</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">DatumStreamMetadataRegistry</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">NodeDatumUrlHelper</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">streamDatumUtils</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;solarnetwork-api-core&quot;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>Most of those exist in the 2.x API, just under different import paths:</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-4">Aggregations</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">DatumFilter</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">DatumReadingTypes</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;solarnetwork-api-core/domain&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-4">AuthorizationV2Builder</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">SolarQueryApi</span><span class="hl-1">, </span><span class="hl-5">// &lt;-- this replaces the NodeDatumUrlHelper!</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;solarnetwork-api-core/net&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">DatumStreamMetadataRegistry</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;solarnetwork-api-core/util&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">datumForStreamData</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;solarnetwork-api-core/util/datum&quot;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>One area that has changed somewhat significantly is the <code>net</code> namespace. The
various <code>*UrlHelper</code> classes have been reworked into <code>Solar*Api</code> classes, such
as <code>SolarQueryApi</code> and <code>SolarUserApi</code>. The methods offered on those classes
remain mostly the same as in the 1.x library, but be sure to confirm with
the API docs. Here again your IDE will generally be able to point out broken
API usage, thanks to the TypeScript definitions included in the library.</p>
<h1 id="building" class="tsd-anchor-link">Building<a href="#building" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The build uses <a href="https://www.npmjs.com/">NPM</a> and requires Node 20+. First, initialize the dependencies:</p>
<pre><code class="sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">ci</span>
</code><button type="button">Copy</button></pre>

<p>Then you can run the <code>build</code> script:</p>
<pre><code class="sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">build:dist</span>
</code><button type="button">Copy</button></pre>

<p>That will produce ES2022 modules with an entry point in <code>lib/index.js</code>.</p>
<p>You can also produce an ES2022 bundle by running <code>npm run build:bundle</code>. That will produce a single
bundled file at <code>lib/solarnetwork-api-core.es.js</code>.</p>
<p>You can also produce an CJS bundle by running <code>npm run build:bundle:cjs</code>. That will produce a single
bundled file at <code>lib/solarnetwork-api-core.es.cjs</code>. This bundle embeds 3rd party dependencies as well.</p>
<h1 id="releases" class="tsd-anchor-link">Releases<a href="#releases" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Releases are done using the gitflow branching model. Gitflow must be installed on your host system.
Then you can run</p>
<pre><code class="shell"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">run</span><span class="hl-1"> </span><span class="hl-2">release</span>
</code><button type="button">Copy</button></pre>

<p>to version, build, commit, and publish the release. See the <a href="https://github.com/mrkmg/node-generate-release">generate-release</a>
site for more information.</p>
<h1 id="unit-tests" class="tsd-anchor-link">Unit tests<a href="#unit-tests" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The unit tests can be run by running the <code>test</code> script:</p>
<pre><code class="sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">test</span>
</code><button type="button">Copy</button></pre>

<p>That will output the test results and produce a HTML code coverage report at <code>coverage/index.html</code>.</p>
<p><a href="https://codecov.io/gh/SolarNetwork/sn-api-core-js"><img src="https://codecov.io/gh/SolarNetwork/sn-api-core-js/graph/badge.svg?token=2YA6X8LUX7" alt="codecov"></a></p>
<p>Having a well-tested and reliable library is a core goal of this project. Unit tests are executed
automatically after every push into the <code>develop</code> branch of this repository and their associated code
coverage is uploaded to <a href="https://codecov.io/github/SolarNetwork/sn-api-core-js/">Codecov</a>.</p>
<p><a href="https://codecov.io/github/SolarNetwork/sn-api-core-js"><img src="https://codecov.io/gh/SolarNetwork/sn-api-core-js/graphs/sunburst.svg?token=2YA6X8LUX7" alt="codecov"></a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#solarnetwork-core-api---javascript"><span>Solar<wbr/>Network <wbr/>Core API -<wbr/> <wbr/>Java<wbr/>Script</span></a><a href="#api-docs"><span>API docs</span></a><a href="#example-query-datum"><span>Example: <wbr/>Query datum</span></a><a href="#example-datumloader"><span>Example: <wbr/>Datum<wbr/>Loader</span></a><a href="#example-multiloader"><span>Example: <wbr/>Multi<wbr/>Loader</span></a><a href="#example-datumrangefinder"><span>Example: <wbr/>Datum<wbr/>Range<wbr/>Finder</span></a><a href="#example-datumsourcefinder"><span>Example: <wbr/>Datum<wbr/>Source<wbr/>Finder</span></a><a href="#example-control-toggler"><span>Example: <wbr/>Control <wbr/>Toggler</span></a><a href="#upgrading-from-1x"><span>Upgrading from 1.x</span></a><a href="#building"><span>Building</span></a><a href="#releases"><span>Releases</span></a><a href="#unit-tests"><span>Unit tests</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">solarnetwork-api-core</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
